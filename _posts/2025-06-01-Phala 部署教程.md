---
layout: mypost
title: Phala éƒ¨ç½²æ•™ç¨‹
date: 2025-06-01
published: true
categories: å…è´¹å®¹å™¨
tags: 
 - phala
 - linux
---

# Phala éƒ¨ç½²æ•™ç¨‹

æ³¨æ„æŸ¥çœ‹è‡ªå·±çš„prodï¼Œæˆªæ­¢åšå®¢æ›´æ–°æ—¶ï¼Œprodé»˜è®¤ä¸º7

## AList

### ç¯å¢ƒå˜é‡

```ini
CLOUDFLARE_API_TOKEN=your_cloudflare_api_token_here
CERTBOT_EMAIL=your_email@example.com
DOMAIN=alist.xxx.com
POSTGRES_PASSWORD=your_password
```



### å®¹å™¨ç¼–æ’

```yaml
services:
  initial_setup:
    image: docker.io/alpine:latest
    container_name: initial_setup
    environment:
      - DOMAIN=${DOMAIN}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
    networks:
      - default
    volumes:
      - alist-data:/opt/alist/data
    command:
      - sh
      - -c
      - |
        echo "ğŸš€ åˆå§‹åŒ–è®¾ç½® - åŸŸå: ${DOMAIN:-'æœªè®¾ç½®'}"
        
        # å®‰è£…å¿…è¦å·¥å…·
        apk add --no-cache curl > /dev/null 2>&1

        # åˆå§‹åŒ–é…ç½®æ–‡ä»¶
        echo "ğŸ“¦ åˆå§‹åŒ–ç›®å½•"
        mkdir -p /opt/alist/data
        echo "ğŸ”½ ä¸‹è½½ config.json..."
        cd /opt/alist/data
        curl -s -L -o config.json https://raw.githubusercontent.com/Raimbaulty/freebsd/main/alist.json
        if [ $? -ne 0 ]; then
          echo "âŒ config.json ä¸‹è½½å¤±è´¥!"
          exit 1
        fi

        # æ›¿æ¢ç¯å¢ƒå˜é‡
        if [ -n "$DOMAIN" ]; then
          sed -i "s/alist.com/$DOMAIN/g" /opt/alist/data/config.json
        else
          echo "âŒ æœªè®¾ç½® DOMAIN ç¯å¢ƒå˜é‡"
          exit 1
        fi
        if [ -n "$POSTGRES_PASSWORD" ]; then
          sed -i "s/alist_password/$POSTGRES_PASSWORD/g" /opt/alist/data/config.json
        else
          echo "âŒ æœªè®¾ç½® POSTGRES_PASSWORD ç¯å¢ƒå˜é‡"
          exit 1
        fi
        
        # éªŒè¯é…ç½®
        if [ ! -s "/opt/alist/data/config.json" ]; then
          echo "âŒ é…ç½®æ–‡ä»¶éªŒè¯å¤±è´¥!"
          exit 1
        fi

        echo "âœ… åˆå§‹åŒ–å®Œæˆ - è®¿é—®åœ°å€: https://$DOMAIN"

  dstack-ingress:
    image: kvin/dstack-ingress:250428
    ports:
      - "443:443"
    networks:
      - default
    environment:
      - GATEWAY_DOMAIN=_.dstack-prod7.phala.network    
      - CLOUDFLARE_API_TOKEN=${CLOUDFLARE_API_TOKEN}
      - CERTBOT_EMAIL=${CERTBOT_EMAIL}
      - SET_CAA=true
      - DOMAIN=${DOMAIN}      
      - TARGET_ENDPOINT=http://alist:5244
    volumes:
      - cert-data:/etc/letsencrypt
      - /var/run/tappd.sock:/var/run/tappd.sock
    restart: unless-stopped

  alist_db:
    container_name: alist_db
    image: postgres:17
    networks:
      - internal
    restart: always
    environment:
      - POSTGRES_USER=alist
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - POSTGRES_DB=alist
    volumes:
      - postgres-data:/var/lib/postgresql/data

  alist:
    image: 'xhofe/alist:beta-aio'
    container_name: alist
    volumes:
      - alist-data:/opt/alist/data
    ports:
      - '5244:5244'
    networks:
      - internal
      - default
    environment:
      - PUID=0
      - PGID=0
      - UMASK=022
      - TZ=Asia/Shanghai
    depends_on:
      - alist_db
      - dstack-ingress
      - initial_setup
    restart: unless-stopped

networks:
  internal:
    driver: bridge
    internal: true

volumes:
  cert-data:
    name: cert-data
  alist-data:
    name: alist-data
  postgres-data:
    name: postgres-data
```



## n8n

### æ–¹æ¡ˆä¸€

å®˜æ–¹ custom domain æ–¹æ¡ˆï¼Œä½†æ˜¯ ws è¿æ¥æœ‰é—®é¢˜

#### ç¯å¢ƒå˜é‡

```ini
CLOUDFLARE_API_TOKEN=your_cloudflare_api_token_here
CERTBOT_EMAIL=your_email@example.com
DOMAIN=n8n.xxx.com
POSTGRES_PASSWORD=your_postgres_password
REDIS_PASSWORD=your_redis_password
WEBHOOK_URL=https://n8n.xxx.com
VUE_APP_URL_BASE_API=https://n8n.xxx.com
```



#### å®¹å™¨ç¼–æ’

```yaml
services:
  initial_setup:
    image: docker.io/alpine:latest
    container_name: initial_setup
    environment:
      - DOMAIN=${DOMAIN}
    volumes:
      - nginx-data:/etc/nginx
      - dist-data:/dist
    command:
      - sh
      - -c
      - |
        echo "ğŸš€ åˆå§‹åŒ–è®¾ç½® - åŸŸå: ${DOMAIN:-'æœªè®¾ç½®'}"
        
        # å®‰è£…å¿…è¦å·¥å…·
        apk add --no-cache curl > /dev/null 2>&1

        # åˆå§‹åŒ– editor-ui
        echo "ğŸ“¦ åˆå§‹åŒ– editor-ui..."
        mkdir -p /dist
        echo "ğŸ”½ ä¸‹è½½ editor-ui.tar.gz..."
        cd /dist
        curl -s -L -o editor-ui.tar.gz https://github.com/other-blowsnow/n8n-i18n-chinese/releases/latest/download/editor-ui.tar.gz
        if [ $? -ne 0 ]; then
          echo "âŒ editor-ui.tar.gz ä¸‹è½½å¤±è´¥!"
          exit 1
        fi
        
        echo "ğŸ“‚ è§£å‹ editor-ui..."
        tar -xzf editor-ui.tar.gz --strip-components=1
        if [ $? -ne 0 ]; then
          echo "âŒ editor-ui è§£å‹å¤±è´¥!"
          exit 1
        fi
        
        rm -f editor-ui.tar.gz
        echo "âœ… editor-ui åˆå§‹åŒ–å®Œæˆ!"        
        
        # é…ç½® Nginx
        echo "ğŸŒ é…ç½® Nginx..."
        mkdir -p /etc/nginx/conf.d
        curl -s -L -o /etc/nginx/nginx.conf https://raw.githubusercontent.com/Raimbaulty/freebsd/main/n8n.conf
        if [ $? -ne 0 ]; then
          echo "âŒ nginx.conf ä¸‹è½½å¤±è´¥!"
          exit 1
        fi
        
        # æ›¿æ¢åŸŸåå˜é‡
        if [ -n "$DOMAIN" ]; then
          sed -i 's/n8n.com/'"$DOMAIN"'/g' /etc/nginx/nginx.conf
          if ! grep -q "$DOMAIN" /etc/nginx/nginx.conf; then
            echo "âŒ åŸŸåæ›¿æ¢å¤±è´¥!"
            exit 1
          fi
        else
          echo "âŒ DOMAIN ç¯å¢ƒå˜é‡æœªè®¾ç½®!"
          exit 1
        fi
        
        rm -f /etc/nginx/conf.d/*.conf
        
        # éªŒè¯é…ç½®
        if [ ! -s "/etc/nginx/nginx.conf" ]; then
          echo "âŒ é…ç½®æ–‡ä»¶éªŒè¯å¤±è´¥!"
          exit 1
        fi        
        
        echo "âœ… åˆå§‹åŒ–å®Œæˆ - è®¿é—®åœ°å€: https://$DOMAIN"

  dstack-ingress:
    image: kvin/dstack-ingress:250428
    ports:
      - "443:443"
    environment:
      - GATEWAY_DOMAIN=_.dstack-prod7.phala.network    
      - CLOUDFLARE_API_TOKEN=${CLOUDFLARE_API_TOKEN}
      - CERTBOT_EMAIL=${CERTBOT_EMAIL}
      - SET_CAA=true
      - DOMAIN=${DOMAIN}      
      - TARGET_ENDPOINT=http://n8n:5678
    depends_on:
      initial_setup:
        condition: service_started
    volumes:
      - /var/run/tappd.sock:/var/run/tappd.sock
      - cert-data:/etc/letsencrypt
    restart: unless-stopped

  n8n-db:
    image: postgres:17
    container_name: n8n-db
    restart: unless-stopped
    environment:
      - TZ=Asia/Shanghai
      - POSTGRES_USER=n8n
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - POSTGRES_DB=n8n
    volumes:
      - postgres-data:/var/lib/postgresql/data
    healthcheck:
      test: ['CMD-SHELL', 'pg_isready -h localhost -U n8n -d n8n']
      interval: 5s
      timeout: 5s
      retries: 10
    networks:
      - internal

  n8n-redis:
    image: redis:latest
    container_name: n8n-redis
    restart: unless-stopped
    command: ["redis-server", "--requirepass", "${REDIS_PASSWORD}", "--bind", "0.0.0.0", "--protected-mode", "yes"]
    volumes:
      - redis-data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "-a", "${REDIS_PASSWORD}", "ping"]
      interval: 5s
      timeout: 5s
      retries: 10
    networks:
      - internal

  n8n:
    image: docker.n8n.io/n8nio/n8n
    container_name: n8n
    restart: unless-stopped
    environment:
      - DB_TYPE=postgresdb
      - DB_POSTGRESDB_HOST=n8n-db
      - DB_POSTGRESDB_PORT=5432
      - DB_POSTGRESDB_DATABASE=n8n
      - DB_POSTGRESDB_USER=n8n
      - DB_POSTGRESDB_PASSWORD=${POSTGRES_PASSWORD}
      - N8N_SECURE_COOKIE=true
      - GENERIC_TIMEZONE=Asia/Shanghai
      - N8N_DEFAULT_LOCALE=zh-CN
      - N8N_PROXY_HOPS=1
      - N8N_RUNNERS_ENABLED=true
      - N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS=true      
      - QUEUE_BULL_REDIS_HOST=n8n-redis
      - QUEUE_BULL_REDIS_PORT=6379
      - QUEUE_BULL_REDIS_PASSWORD=${REDIS_PASSWORD}
      - WEBHOOK_URL=${WEBHOOK_URL}
      - VUE_APP_URL_BASE_API=${VUE_APP_URL_BASE_API}
    ports:
      - "5678:5678"
    volumes:
      - n8n-data:/home/node/.n8n
      - dist-data:/usr/local/lib/node_modules/n8n/node_modules/n8n-editor-ui/dist
    depends_on:
      initial_setup:
        condition: service_started
      n8n-db:
        condition: service_healthy
      n8n-redis:
        condition: service_healthy
    networks:
      - internal
      - default

networks:
  internal:
    driver: bridge
    internal: true

volumes:
  nginx-data:
    name: nginx-data
  cert-data:
    name: cert-data
  dist-data:
    name: dist-data
  redis-data:
    name: redis-data
  n8n-data:
    name: n8n-data
  postgres-data:
    name: postgres-data    
```

### æ–¹æ¡ˆäºŒ

cloudflared æ–¹æ¡ˆ

#### ç¯å¢ƒå˜é‡

```ini
CLOUDFLARE_TUNNEL_TOKEN=your_cloudflar_tunnel_token
POSTGRES_PASSWORD=your_postgres_password
REDIS_PASSWORD=your_redis_password
WEBHOOK_URL=https://n8n.xxx.com
VUE_APP_URL_BASE_API=https://n8n.xxx.com
```

#### å®¹å™¨ç¼–æ’

```yaml
services:
  initial_setup:
    image: docker.io/alpine:latest
    container_name: initial_setup
    networks:
      - default
    volumes:
      - dist-data:/dist
    command:
      - sh
      - -c
      - |
        echo "ğŸš€ åˆå§‹åŒ–è®¾ç½®"
        
        # å®‰è£…å¿…è¦å·¥å…·
        apk add --no-cache curl > /dev/null 2>&1

        # åˆå§‹åŒ– editor-ui
        echo "ğŸ“¦ åˆå§‹åŒ– editor-ui..."
        mkdir -p /dist
        echo "ğŸ”½ ä¸‹è½½ editor-ui.tar.gz..."
        cd /dist
        curl -s -L -o editor-ui.tar.gz https://github.com/other-blowsnow/n8n-i18n-chinese/releases/latest/download/editor-ui.tar.gz
        if [ $$? -ne 0 ]; then
          echo "âŒ editor-ui.tar.gz ä¸‹è½½å¤±è´¥!"
          exit 1
        fi
        
        echo "ğŸ“‚ è§£å‹ editor-ui..."
        tar -xzf editor-ui.tar.gz --strip-components=1
        if [ $$? -ne 0 ]; then
          echo "âŒ editor-ui è§£å‹å¤±è´¥!"
          exit 1
        fi
        
        rm -f editor-ui.tar.gz
        echo "âœ… editor-ui åˆå§‹åŒ–å®Œæˆ!" 
        echo "âœ… åˆå§‹åŒ–å®Œæˆ!"

  n8n-tunnel:
    image: milgradesec/cloudflared:latest
    container_name: n8n-tunnel
    restart: unless-stopped
    networks:
      - default
    command: ["tunnel", "--no-autoupdate", "run", "--token", "${CLOUDFLARE_TUNNEL_TOKEN}"]

  n8n-db:
    image: postgres:17
    container_name: n8n-db
    restart: unless-stopped
    environment:
      - TZ=Asia/Shanghai
      - POSTGRES_USER=n8n
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - POSTGRES_DB=n8n
    volumes:
      - postgres-data:/var/lib/postgresql/data
    healthcheck:
      test: ['CMD-SHELL', 'pg_isready -h localhost -U n8n -d n8n']
      interval: 5s
      timeout: 5s
      retries: 10
    networks:
      - internal

  n8n-redis:
    image: redis:latest
    container_name: n8n-redis
    restart: unless-stopped
    command: ["redis-server", "--requirepass", "${REDIS_PASSWORD}", "--bind", "0.0.0.0", "--protected-mode", "yes"]
    volumes:
      - redis-data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "-a", "${REDIS_PASSWORD}", "ping"]
      interval: 5s
      timeout: 5s
      retries: 10
    networks:
      - internal

  n8n:
    image: docker.n8n.io/n8nio/n8n
    container_name: n8n
    restart: unless-stopped
    environment:
      - DB_TYPE=postgresdb
      - DB_POSTGRESDB_HOST=n8n-db
      - DB_POSTGRESDB_PORT=5432
      - DB_POSTGRESDB_DATABASE=n8n
      - DB_POSTGRESDB_USER=n8n
      - DB_POSTGRESDB_PASSWORD=${POSTGRES_PASSWORD}
      - N8N_SECURE_COOKIE=true
      - GENERIC_TIMEZONE=Asia/Shanghai
      - N8N_DEFAULT_LOCALE=zh-CN
      - N8N_PROXY_HOPS=1
      - N8N_RUNNERS_ENABLED=true
      - N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS=true
      - QUEUE_BULL_REDIS_HOST=n8n-redis
      - QUEUE_BULL_REDIS_PORT=6379
      - QUEUE_BULL_REDIS_PASSWORD=${REDIS_PASSWORD}
      - WEBHOOK_URL=${WEBHOOK_URL}
      - VUE_APP_URL_BASE_API=${VUE_APP_URL_BASE_API}
    ports:
      - "5678:5678"
    volumes:
      - n8n-data:/home/node/.n8n
      - dist-data:/usr/local/lib/node_modules/n8n/node_modules/n8n-editor-ui/dist
    depends_on:
      initial_setup:
        condition: service_completed_successfully
      n8n-db:
        condition: service_healthy
      n8n-redis:
        condition: service_healthy
    networks:
      - internal
      - default

networks:
  internal:
    driver: bridge
    internal: true

volumes:
  dist-data:
    name: dist-data
  redis-data:
    name: redis-data
  n8n-data:
    name: n8n-data
  postgres-data:
    name: postgres-data
```



## Calibre-web

[ç‚¹å‡»ä¸‹è½½](https://calibre-ebook.com/dist/win64) æ¡Œé¢ç«¯ï¼Œä¸‹è½½ååŒå‡»å®‰è£…ï¼Œä½¿ç”¨é»˜è®¤è®¾ç½®å®‰è£…åä¼šè‡ªåŠ¨æ‰“å¼€

ä¸è¦ç›´æ¥ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„ `metadata.db`ï¼Œéœ€è¦ç‚¹å‡» **Calibre ä¹¦åº“** â†’ **åˆ‡æ¢/å»ºç«‹ä¹¦åº“**ï¼Œå‹¾é€‰ **åœ¨æ–°çš„ä½ç½®å»ºç«‹ç©ºçš„ä¹¦åº“**ï¼Œé€‰æ‹©ä½ç½®åç‚¹å‡» **ç¡®å®š**ï¼Œç„¶åè¿›å…¥æ–°ä½ç½®æ‰€åœ¨çš„æ–‡ä»¶å¤¹ï¼Œå°† `metadata.db` ä¸Šä¼ å³å¯

### ç¯å¢ƒå˜é‡

```ini
DOMAIN=calibre.xxx.com
CERTBOT_EMAIL=xxx@xxx.com
CLOUDFLARE_API_TOKEN=*************************
```

### å®¹å™¨ç¼–æ’

```yaml
services:
  initial_setup:
    image: docker.io/alpine:latest
    container_name: initial_setup
    environment:
      - DOMAIN=${DOMAIN}
    volumes:
      - calibre-data:/app/calibre-web
      - nginx-data:/etc/nginx
    command:
      - sh
      - -c
      - |
        echo "ğŸš€ åˆå§‹åŒ–è®¾ç½® - åŸŸå: ${DOMAIN:-'æœªè®¾ç½®'}"
        
        # å®‰è£…å¿…è¦å·¥å…·
        apk add --no-cache curl > /dev/null 2>&1
        
        # åˆå§‹åŒ– Calibre æ•°æ®åº“
        if [ ! -f "/app/calibre-web/books/metadata.db" ]; then
          echo "ğŸ“š åˆå§‹åŒ– Calibre æ•°æ®åº“..."
          mkdir -p /app/calibre-web/books
          chown -R 1000:1000 /app/calibre-web
          cd /app/calibre-web/books 
          curl -s -L -o metadata.db https://raw.githubusercontent.com/Raimbaulty/freebsd/main/metadata.db
          if [ $? -ne 0 ]; then
            echo "âŒ metadata.db ä¸‹è½½å¤±è´¥!"
            exit 1
          fi
          chmod 666 /app/calibre-web/books/metadata.db
          echo "âœ… Calibre æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ"
        fi

        # é…ç½® Nginx
        echo "ğŸŒ é…ç½® Nginx..."
        mkdir -p /etc/nginx/conf.d
        curl -s -L -o /etc/nginx/nginx.conf https://raw.githubusercontent.com/Raimbaulty/freebsd/main/calibre.conf
        if [ $? -ne 0 ]; then
          echo "âŒ nginx.conf ä¸‹è½½å¤±è´¥!"
          exit 1
        fi
        
        # æ›¿æ¢åŸŸåå˜é‡
        if [ -n "$DOMAIN" ]; then
          sed -i 's/calibre-web.com/'"$DOMAIN"'/g' /etc/nginx/nginx.conf
          if ! grep -q "$DOMAIN" /etc/nginx/nginx.conf; then
            echo "âŒ åŸŸåæ›¿æ¢å¤±è´¥!"
            exit 1
          fi
        else
          echo "âŒ DOMAIN ç¯å¢ƒå˜é‡æœªè®¾ç½®!"
          exit 1
        fi
        
        rm -f /etc/nginx/conf.d/*.conf
        
        # éªŒè¯é…ç½®
        if [ ! -s "/etc/nginx/nginx.conf" ] || [ ! -s "/app/calibre-web/books/metadata.db" ]; then
          echo "âŒ é…ç½®æ–‡ä»¶éªŒè¯å¤±è´¥!"
          exit 1
        fi
        
        echo "âœ… åˆå§‹åŒ–å®Œæˆ - è®¿é—®åœ°å€: https://$DOMAIN"
      
  calibre-web:
    image: linuxserver/calibre-web:latest
    container_name: calibre-web
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Asia/Shanghai
      - DOCKER_MODS=linuxserver/mods:universal-calibre
      - OAUTHLIB_RELAX_TOKEN_SCOPE=1
      - OAUTHLIB_INSECURE_TRANSPORT=1
      - HTTP_X_SCHEME=https
      - HTTP_X_FORWARDED_PROTO=https
      - HTTP_X_FORWARDED_PORT=443            
    ports:
      - 8083:8083      
    volumes:
      - calibre-data:/app/calibre-web
    restart: always
    depends_on:
      - initial_setup
    networks:
      - internal
      - default

  dstack-ingress:
    image: kvin/dstack-ingress:250428
    ports:
      - "443:443"
    environment:
      - GATEWAY_DOMAIN=_.dstack-prod7.phala.network    
      - CLOUDFLARE_API_TOKEN=${CLOUDFLARE_API_TOKEN}
      - CERTBOT_EMAIL=${CERTBOT_EMAIL}
      - SET_CAA=true
      - DOMAIN=${DOMAIN}      
      - TARGET_ENDPOINT=http://calibre-web:8083
    volumes:
      - /var/run/tappd.sock:/var/run/tappd.sock
      - cert-data:/etc/letsencrypt
      - nginx-data:/etc/nginx
    restart: unless-stopped
    depends_on:
      - initial_setup    
    networks:
      - default

networks:
  internal:
    driver: bridge
    internal: true      
    
volumes:
  cert-data:
    name: cert-data
  calibre-data:
    name: calibre-data
  nginx-data:
    name: nginx-data
```

### ä½¿ç”¨é…ç½®ï¼ˆç®¡ç†å‘˜å‘ï¼‰

#### åŸºæœ¬é…ç½®

åˆå§‹ç”¨æˆ·å `admin`ï¼Œå¯†ç  `admin123` ç™»å½• Calibre-web ç«™ç‚¹

ç™»å½•åç‚¹å‡» ğŸ“ å›¾æ ‡ï¼Œè¿›å…¥ **books** ç›®å½•ï¼Œç‚¹å‡»é€‰ä¸­ **metadata.db** åä¿å­˜

ç‚¹å‡»é¡¶éƒ¨å¯¼èˆªæ çš„ **admin** èœå•ï¼Œä¾æ¬¡ä¿®æ”¹ç”¨æˆ·åã€ç”¨æˆ·é‚®ç®±ã€å¯†ç ã€æ¨é€é‚®ç®±ï¼Œå¹¶ä¿®æ”¹è¯­è¨€ä¸ºä¸­æ–‡ï¼Œç„¶åç‚¹å‡»åº•éƒ¨ä¿å­˜

ç‚¹å‡»é¡¶éƒ¨å¯¼èˆªæ çš„ **ç®¡ç†æƒé™** èœå•ï¼Œç‚¹å‡» **ç¼–è¾‘åŸºæœ¬é…ç½®**ï¼Œå±•å¼€ **æ‹“å±•ç¨‹åºé…ç½®**ï¼Œ**Path to Calibre Binaries** è¾“å…¥ `/usr/bin` åç‚¹å‡»ä¿å­˜

#### ç”¨æˆ·ç®¡ç†

ç‚¹å‡»é¡¶éƒ¨å¯¼èˆªæ çš„ **ç®¡ç†æƒé™** èœå•ï¼Œç‚¹å‡» **ç¼–è¾‘åŸºæœ¬é…ç½®**ï¼Œå±•å¼€ **åŠŸèƒ½é…ç½®**ï¼Œå‹¾é€‰ **å¯ç”¨æ³¨å†Œ** ä½†ä¸å‹¾é€‰ **ä½¿ç”¨é‚®ç®±æˆ–ç”¨æˆ·å** åä¿å­˜

ç‚¹å‡»é¡¶éƒ¨å¯¼èˆªæ çš„ **ç®¡ç†æƒé™** èœå•ï¼Œç‚¹å‡» **ç¼–è¾‘ç•Œé¢é…ç½®**ï¼Œå±•å¼€ **æ–°ç”¨æˆ·é»˜è®¤æƒé™è®¾ç½®**ï¼Œå‹¾é€‰éœ€è¦çš„æƒé™å¹¶é€‰æ‹©é»˜è®¤è¯­è¨€åä¿å­˜

#### GitHubç™»å½•

[ç‚¹å‡»è¿™é‡Œ](https://github.com/settings/apps/new) åˆ›å»ºåº”ç”¨ï¼Œ**Homepage URL** å¡«å†™ `https://n8n.xxx.com`ï¼Œ**Callback URL** å¡«å†™ `http://n8n.xxx.com/login/github/authorized`ï¼Œå–æ¶ˆå‹¾é€‰ **Webhook** çš„ Active ç‚¹å‡» **Save changes**

å›åˆ° Calibre-web ç«™ç‚¹ï¼Œç‚¹å‡»é¡¶éƒ¨å¯¼èˆªæ çš„ **ç®¡ç†æƒé™** èœå•ï¼Œç‚¹å‡» **ç¼–è¾‘åŸºæœ¬é…ç½®**ï¼Œå±•å¼€ **åŠŸèƒ½é…ç½®**ï¼Œ**ç™»å½•ç±»å‹** é€‰æ‹© `ä½¿ç”¨ OAuth è®¤è¯`ï¼Œä¾æ¬¡å¡«å…¥ github OAuth å®¢æˆ·ç«¯ Id å’Œ github OAuth å®¢æˆ·ç«¯ Secret åä¿å­˜

ç‚¹å‡»å³ä¸Šè§’ç”¨æˆ·åï¼Œç‚¹å‡» **github OAuth è®¾ç½®** æ—çš„ **é“¾æ¥**ï¼Œä½¿ç”¨ GitHub è´¦æˆ·ç™»å½•å®Œæˆç»‘å®šï¼Œè´¦æˆ·å°±å¯ä½¿ç”¨ GitHub ç™»å½•äº†

#### ä¸Šä¼ ä¹¦ç±

å³ä¸Šè§’é€€å‡ºç™»å½•ï¼Œä½¿ç”¨æ–°çš„ç”¨æˆ·åå¯†ç ç™»å½•ï¼Œç‚¹å‡»é¡¶éƒ¨å¯¼èˆªæ çš„ **ç®¡ç†æƒé™** èœå•ï¼Œç‚¹å‡» **ç¼–è¾‘åŸºæœ¬é…ç½®**ï¼Œå±•å¼€ **åŠŸèƒ½é…ç½®**ï¼Œå‹¾é€‰ **å¯ç”¨ä¸Šä¼ ** åç‚¹å‡» åº•éƒ¨ **ä¿å­˜**

ç‚¹å‡»é¡¶éƒ¨å¯¼èˆªæ çš„ **ç®¡ç†æƒé™** èœå•ï¼Œç‚¹å‡» **ç®¡ç†ç”¨æˆ·**ï¼Œå‹¾é€‰ **å…è®¸ä¸Šä¼ ä¹¦ç±** åº•éƒ¨çš„æ–¹å½¢æ¡†ï¼Œåˆ·æ–°é¡µé¢å°±å¯ä»¥çœ‹åˆ° **ä¸Šä¼ ä¹¦ç±** æŒ‰é’®äº†

ä¸Šä¼ ä¹¦ç±åï¼Œç‚¹å‡»åº•éƒ¨ **è·å–å…ƒæ•°æ®**ï¼Œå…ˆæœç´¢ä¹¦ç±åç§°ï¼Œç„¶åä»…å‹¾é€‰ **è±†ç“£**ï¼Œç‚¹å‡»æ­£ç¡®çš„ä¹¦ç±å°é¢å›¾è‡ªåŠ¨å¯¼å…¥å…ƒæ•°æ®ï¼Œç„¶åç‚¹å‡» **ä¿å­˜**

å¦‚æœä¸Šä¼ æŠ¥é”™æç¤º `File type isn't allowed to be uploaded to this server`ï¼Œç‚¹å‡»é¡¶éƒ¨å¯¼èˆªæ çš„ **ç®¡ç†æƒé™** èœå•ï¼Œç‚¹å‡» **ç¼–è¾‘åŸºæœ¬é…ç½®**ï¼Œå±•å¼€ **å®‰å…¨è®¾ç½®**ï¼Œå–æ¶ˆå‹¾é€‰ `Check if file extensions matches file content on upload` åé‡è¯•

#### æ¨é€ä¹¦ç±

é¦–å…ˆéœ€è¦è‡ªå¤‡ä¸€å°ç”µå­ä¹¦è®¾å¤‡ï¼Œä¸‹é¢ä»‹ç»çš„æ˜¯ Kindle çš„æ•™ç¨‹

ç‚¹å‡» Calibre-web ç«™ç‚¹é¡¶éƒ¨å¯¼èˆªæ çš„ **ç®¡ç†æƒé™** èœå•ï¼Œç‚¹å‡» **ç¼–è¾‘é‚®ä»¶æœåŠ¡å™¨è®¾ç½®**ï¼Œ**SMTP ä¸»æœºå** å¡«å†™ SMTP æœåŠ¡å™¨åœ°å€ï¼Œ**åŠ å¯†** é€‰æ‹© STARTTLS åè®®ï¼Œå¦‚æœåç»­æµ‹è¯•ä¸é€šè¿‡å¯ä»¥ä¿®æ”¹ä¸º **æ— ** é‡è¯•ï¼Œå…¶ä»–è‡ªè¡Œå¡«å…¥åç‚¹å‡»åº•éƒ¨ **ä¿å­˜è®¾ç½®å¹¶å‘é€æµ‹è¯•é‚®ä»¶**ï¼Œç‚¹å‡»é¡¶éƒ¨å¯¼èˆªæ çš„ **ä»»åŠ¡åˆ—è¡¨** èœå•æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€ï¼Œä¹Ÿå¯ç™»å…¥ä½ è®¾ç½®çš„æœåŠ¡é‚®ç®±åœ°å€ç¡®è®¤æµ‹è¯•é‚®ä»¶

[ç‚¹å‡»æ³¨å†Œ](https://www.amazon.com/) Amazon ç¾åŒºè´¦å·ï¼Œå¦‚æœ Kindle ç™»å½•è¿‡ä¸­äºšè´¦å·éœ€è¦å…ˆæ³¨é”€ï¼Œç„¶åä½¿ç”¨æ–°è´¦å·åœ¨Kindleç™»å½•å¹¶è·å¾—è®¾å¤‡éªŒè¯ç 

[ç‚¹å‡»è¿™é‡Œ](https://www.amazon.com/code) ç™»å½•ç¾åŒºè´¦å·éªŒè¯åè¾“å…¥è®¾å¤‡éªŒè¯ç ç»‘å®šè®¾å¤‡ï¼Œç„¶å [ç‚¹å‡»è¿™é‡Œ](https://www.amazon.com/hz/mycd/myx#/home/settings/payment) æ¥ç€ç‚¹å‡» **Personal Document Settings** â†’ **Add a new e-mail address**ï¼Œæ·»åŠ ä½ çš„æœåŠ¡é‚®ç®±åœ°å€

[ç‚¹å‡»è¿™é‡Œ](https://www.amazon.com/hz/mycd/digital-console/alldevices) è¿›å…¥ç»‘å®šå¥½çš„è®¾å¤‡ï¼Œå¯ä»¥ç‚¹å‡» **Email** æ—è¾¹çš„ Edit ä¿®æ”¹åœ°å€ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªåœ°å€ä½œä¸ºè½¬å‘é‚®ç®±åœ°å€

å›åˆ° Calibre-web ç«™ç‚¹ï¼Œç‚¹å‡»å¤´åƒ - ç”¨æˆ·åï¼Œåœ¨ **Send to eReader Email Address. Use comma to separate emails for multiple eReaders** å¡«å†™è½¬å‘é‚®ç®±åœ°å€

ç‚¹å‡»å·¦ä¾§ **ä¹¦ç±** èœå•ï¼Œç‚¹å‡»éœ€è¦æ¨é€çš„ä¹¦ç±ï¼Œç‚¹å‡»æ¨é€

ç‚¹å‡»é¡¶éƒ¨å¯¼èˆªæ çš„ **ä»»åŠ¡åˆ—è¡¨** èœå•æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€

#### ç§»åŠ¨è®¾å¤‡

IOS åº”ç”¨å•†åº—æœç´¢ KyBook 3ï¼ŒAndroid åº”ç”¨å•†åº—æœç´¢ Librera ä¸‹è½½ï¼Œè¿™é‡Œè®²è§£ KyBook 3 çš„ä½¿ç”¨æ–¹æ³•

è¿›å…¥åº”ç”¨åï¼Œç‚¹å‡» **ç›®å½•**ï¼Œç„¶åç‚¹å‡» **æ·»åŠ **ï¼Œæ ‡é¢˜è¾“å…¥` Calibre`ï¼ŒURLè¾“å…¥ `https://ç«™ç‚¹åœ°å€/opds` æ·»åŠ ï¼Œç„¶åè¾“å…¥ç”¨æˆ·åå¯†ç éªŒè¯å³å¯

## Zenfeed

### ç¯å¢ƒå˜é‡

```ini
DOMAIN=zen.xxx.com
CERTBOT_EMAIL=admin@example.com
CLOUDFLARE_API_TOKEN=hijklmnopqrst
```

### å®¹å™¨ç¼–æ’

```yaml
services:
  dstack-ingress:
    container_name: dstack-ingress
    image: kvin/dstack-ingress:250428
    ports:
      - "443:443"
    environment:
      - GATEWAY_DOMAIN=_.dstack-prod7.phala.network
      - CLOUDFLARE_API_TOKEN=${CLOUDFLARE_API_TOKEN}
      - CERTBOT_EMAIL=${CERTBOT_EMAIL}
      - SET_CAA=true
      - DOMAIN=${DOMAIN}
      - TARGET_ENDPOINT=http://zenfeed-web:1400
    volumes:
      - /var/run/tappd.sock:/var/run/tappd.sock
      - cert-data:/etc/letsencrypt
    restart: unless-stopped
    networks:
      - zenfeed-net

  zenfeed-web:
    image: glidea/zenfeed-web:latest
    ports:
      - "1400:1400"
    environment:
      - PUBLIC_DEFAULT_API_URL=http://zenfeed:1300
    depends_on:
      - zenfeed
    restart: unless-stopped
    networks:
      - zenfeed-net

  zenfeed:
    image: glidea/zenfeed:latest
    entrypoint: >
      sh -c "
      if [ ! -f /app/config/config.yaml ]; then
        echo 'Config file not found in volume, initializing from base config...'
        cp /app/config.base.yaml /app/config/config.yaml;
      else
        echo 'Existing config file found in volume.'
      fi &&
      echo 'Starting Zenfeed...' &&
      exec /app/zenfeed --config /app/config/config.yaml
      "
    configs:
      - source: zenfeed_config_base
        target: /app/config.base.yaml
    volumes:
      - zenfeed-data:/app/data
      - zenfeed-config:/app/config
    depends_on:
      - rsshub
    restart: unless-stopped
    networks:
      - zenfeed-net
    
  rsshub:
    image: diygod/rsshub:2024-12-14
    environment:
      - NODE_ENV=production
    restart: unless-stopped
    networks:
      - zenfeed-net
      
volumes:
  zenfeed-data:
    name: zenfeed_data
  zenfeed-data:
    name: zenfeed-data
  cert-data:
    name: cert-data

configs:
  zenfeed_config_base:
    content: |
      timezone: ${TZ:-Asia/Shanghai}
      llms:
        - name: general
          default: true
          provider: siliconflow
          model: Qwen/Qwen2.5-7B-Instruct
          api_key: ${API_KEY:-your-api-key}
        - name: embed
          provider: siliconflow
          embedding_model: Pro/BAAI/bge-m3
          api_key: ${API_KEY:-your-api-key}
      scrape:
        rsshub_endpoint: http://rsshub:1200
      storage:
        feed:
          rewrites:
            - transform:
                to_text:
                  prompt: |
                    {{ .summary_html_snippet }} Respond in ${LANG:-Chinese}
              label: summary_html_snippet
          embedding_llm: embed
      notify:
        channels:
          email:
            feed_html_snippet_template: |
              {{ .summary_html_snippet }}

networks:
  zenfeed-net:
    driver: bridge
```



## Chat-Share

### ç¯å¢ƒå˜é‡

```ini
DOMAIN=share.xxx.com
SECRET_KEY=1234567abcdefg
AUTHORIZATION=sk-123
CERTBOT_EMAIL=admin@example.com
CLOUDFLARE_API_TOKEN=hijklmnopqrst
```

### å®¹å™¨ç¼–æ’

```yaml
services:
  dstack-ingress:
    image: kvin/dstack-ingress:250428
    ports:
      - "443:443"
    environment:
      - GATEWAY_DOMAIN=_.dstack-prod7.phala.network    
      - CLOUDFLARE_API_TOKEN=${CLOUDFLARE_API_TOKEN}
      - CERTBOT_EMAIL=${CERTBOT_EMAIL}
      - SET_CAA=true
      - DOMAIN=${DOMAIN}      
      - TARGET_ENDPOINT=http://chat-share:5100
    volumes:
      - /var/run/tappd.sock:/var/run/tappd.sock
      - cert-data:/etc/letsencrypt
    restart: unless-stopped
    
  chat-share:
    image: ghcr.io/h88782481/chat-share:latest
    container_name: chat-share    
    restart: unless-stopped
    environment:
      - TZ=Asia/Shanghai
      - SECRET_KEY=${SECRET_KEY}
      - AUTHORIZATION=${AUTHORIZATION}
      - DOMAIN_CHATGPT=https://898u-lan.hf.space
      - DOMAIN_CLAUDE=https://mpfo-fo.hf.space
    volumes:
      - share-data:/app/data
      
volumes:
  cert-data:
  	-name: cert-data
  share-data:
  	-name: share-data
```



## Elasticsearch/Kibana

### å®¹å™¨ç¼–æ’

```yaml
services:
  dstack-ingress:
    image: kvin/dstack-ingress:250428
    ports:
      - "443:443"
    environment:
      - GATEWAY_DOMAIN=_.dstack-prod7.phala.network    
      - CLOUDFLARE_API_TOKEN=${CLOUDFLARE_API_TOKEN}
      - CERTBOT_EMAIL=${CERTBOT_EMAIL}
      - SET_CAA=true
      - DOMAIN=${DOMAIN}      
      - TARGET_ENDPOINT=http://elasticsearch:65536
    volumes:
      - /var/run/tappd.sock:/var/run/tappd.sock
      - cert-data:/etc/letsencrypt
    restart: unless-stopped
      
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.4.2
    container_name: elasticsearch
    environment:
      - discovery.type=single-node
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
      - "http.cors.enabled=true"
      - "http.cors.allow-origin=*"
      - "xpack.security.enabled=false"
      - "cluster.name=es-docker-cluster"
      - "network.bind_host=0.0.0.0"
      - "network.publish_host=0.0.0.0"
    ulimits:
      memlock:
        soft: -1
        hard: -1
      nofile:
        soft: 65536
        hard: 65536
    volumes:
      - elasticsearch-data:/usr/share/elasticsearch/data
    ports:
      - 9200:9200
      - 9300:9300
    networks:
      - elk-network
      # elk-network:
      #   aliases:
      #     - elasticsearch
    restart: always

  kibana:
    image: docker.elastic.co/kibana/kibana:7.4.2
    container_name: kibana
    environment:
      - "ELASTICSEARCH_HOSTS=http://elasticsearch:9200"
      - "SERVER_NAME=kibana"
      - "SERVER_HOST=0.0.0.0"
      - "ELASTICSEARCH_REQUESTTIMEOUT=90000"
    ports:
      - 5601:5601
    networks:
      - elk-network
    restart: on-failure
    depends_on:
      - elasticsearch

  setup-plugin:
    image: docker.io/alpine:latest
    container_name: setup-plugin
    ports:
      - 9999:9999
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    command: >
      sh -c '
        echo "ç­‰å¾… Elasticsearch å¯åŠ¨..." &&
        sleep 30 &&
        echo "å¼€å§‹å®‰è£… Docker CLI å·¥å…·..." &&
        apk add --no-cache docker-cli curl &&
        echo "å¼€å§‹æ£€æŸ¥ Elasticsearch å¥åº·çŠ¶æ€..." &&
        until curl -s http://elasticsearch:9200/_cluster/health | grep -q "status"; do
          echo "ç­‰å¾… Elasticsearch å¥åº·æ£€æŸ¥é€šè¿‡..."
          sleep 5
        done &&
        echo "Elasticsearch å·²å¯åŠ¨ï¼Œå¼€å§‹å®‰è£…åˆ†è¯å™¨..." &&
        docker exec elasticsearch elasticsearch-plugin install --batch https://release.infinilabs.com/analysis-ik/stable/elasticsearch-analysis-ik-7.4.2.zip &&
        echo "IK åˆ†è¯å™¨å®‰è£…å®Œæˆï¼Œé‡å¯ Elasticsearch..." &&
        docker restart elasticsearch &&
        echo "Elasticsearch é‡å¯å®Œæˆï¼Œç­‰å¾…æœåŠ¡å°±ç»ª..." &&
        sleep 30 &&
        echo "å®‰è£…æµç¨‹å®Œæˆ!"
      '
    depends_on:
      - elasticsearch
    networks:
      - elk-network

  watchtower:
    image: containrrr/watchtower
    container_name: watchtower
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    command: --cleanup --interval 300

networks:
  elk-network:
    driver: bridge
  default:
    driver: bridge

volumes:
  cert-dataï¼š
  	name: cert-data
  elasticsearch-data:
    driver: local  
  	name:elasticsearch-data
```

## å‚è€ƒé“¾æ¥

- https://linux.do/t/topic/611405/25
- https://github.com/janeczku/calibre-web/issues/2383
