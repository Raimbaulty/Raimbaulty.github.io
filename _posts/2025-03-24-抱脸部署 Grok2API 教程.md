---
layout: mypost
title: 抱脸部署 Grok2API 教程
date: 2025-03-24
published: true
categories: 自部署
tags: 
 - aitool
---

## 部署

[点击这里](https://huggingface.co/login?next=%2Fnew-space) 创建空间 选择 Docker 然后在Files添加或者修改下面提到的环境变量和文件

### 环境变量

| 变量名                | 示例值                          | 描述                                                         |
| :-------------------- | :------------------------------ | :----------------------------------------------------------- |
| PROXY                 | socks5://************          | 可选，代理地址，支持 https 和 socks5                         |
| PORT | 7860 | 可选，服务部署端口，默认 3000 |
| IS_CUSTOM_SSO         | false                           | 可选，是否开启直接代理，默认 false |
| SSO                   | eyJ************,eyJ************ | 关闭直接代理时填写，普通账户令牌，取自Grok官网Cookie的sso值 |
| SSO_SUPER | eyJ************,eyJ***********  | 关闭直接代理时填写，会员账户令牌，取自Grok官网Cookie的sso值  |
| API_KEY               | sk-12345                        | 关闭直接代理时必填，默认 sk-123456，开启直接代理时不填写 |
| PICGO_KEY             | chv_************                | 绘图必选，Picgo 图床密钥，与 TUMY_KEY 二选一                 |
| TUMY_KEY              |                                 | 绘图必选，TUMY图床密钥，与 PICGO_KEY 二选一                  |
| FILTERED_TAGS | grok:render | 可选，需要去掉的标签 |
| CF_CLEARANCE          | `cf_clearance=xxxxxx`           | 可选，Cloudflare 免托管凭据， 取自Grok官网Cookie的cf_clearance值 |
| IS_TEMP_CONVERSATION  | true                            | 可选，开启临时对话，默认false                                |
| SHOW_THINKING         | true                            | 可选，显示思考过程，默认false                                |
| SHOW_SEARCH_RESULTS | true                            | 可选，显示搜索内容，默认true                                |
| MANAGER_SWITCH        | false                           | 可选，开启管理后台，默认false                                |
| ADMINPASSWORD         | password                        | 可选，管理员密码，默认空值                                   |

### 配置文件

#### Dockerfile

若要使用外部轮询工具，如 gpt-load，gpt-load 上游地址填写抱脸服务地址，并将环境变量 `IS_CUSTOM_SSO` 改为 `True`

```dockerfile
FROM python:3.10-slim

# 安装构建依赖
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential \
    curl \
    && rm -rf /var/lib/apt/lists/*

# 创建用户
RUN useradd -m -u 1000 -s /bin/bash grok

# 安装 Python 依赖
RUN pip install --no-cache-dir flask requests curl_cffi werkzeug loguru python-dotenv patchright
RUN python -m patchright install --with-deps chrome

# 设置工作目录
WORKDIR /home/grok/app

# 复制应用文件
COPY --chown=grok:grok . .

# 创建数据目录并设置权限
RUN mkdir -p /home/grok/app/data && \
    chown -R grok:grok /home/grok/app && \
    chmod -R 755 /home/grok/app

# 切换到非 root 用户
USER grok

ENV PORT=7860
ENV IS_CUSTOM_SSO=False
ENV SHOW_SEARCH_RESULTS=False
ENV FILTERED_TAGS=grok:render

EXPOSE 7860

CMD ["python", "app.py"]
```

#### README.md

```markdown
---
title: Grok2API
emoji: 🦀
colorFrom: yellow
colorTo: yellow
sdk: docker
pinned: false
---
```

#### 主文件

- 主程序：`app.py`，[点击复制](https://raw.githubusercontent.com/VeroFess/grok2api/main/app.py)

  注意修改 `/data` 为 `/home/grok/app/data"`， `./data/chrome` 为 `/home/grok/app/chrome"`

- 登录页：`/templates/login.html`，[点击复制](https://raw.githubusercontent.com/VeroFess/grok2api/main/templates/login.html)

- 管理页：`/templates/manager.html`，[点击复制](https://raw.githubusercontent.com/VeroFess/grok2api/main/templates/manager.html)

## 参考链接

- [grok逆向给个grok校验参数的免费接口吧 x-statsig-id](https://linux.do/t/topic/685667) 
- [「eleme」手摸手教你复活grok2api_python 附x-statsig-id部分算法](https://linux.do/t/topic/679268) 
