---
layout: mypost
title: Linux 使用笔记
date: 2025-01-10
published: true
categories: 笔记
tags: 
 - linux
---

## 基础

-   修改时区
    
    ```bash
    sudo timedatectl set-timezone Asia/Shanghai
    ```
    
-   查看日历
    
    ```bash
    sudo apt install ncal
    cal
    cal 1 2025
    cal 2025
    ```
    
-   查看天气
    
    ```bash
    curl -H 'Accept-Language:zh-CN' wttr.in/Beijin
    ```
    
-   创建用户
    
    ```bash
    sudo adduser --disabled-password --gecos "" 你的用户名 && echo "你的用户名:你的密码" | sudo chpasswd && sudo usermod -aG sudo 你的用户名
    ```
    
-   正确赋权
    
    ```bash
    sudo chown -R $(whoami):$(whoami) /home/$(whoami) && chmod 700 /home/$(whoami)
    chmod 700 ~/.ssh && chmod 600 ~/.ssh/authorized_keys
    ```
    
-   配置 ssh
    
    -   在本地生成密钥
        
        ```bash
        ssh-keygen -t rsa -b 4096 -C "注释"
        ssh-copy-id 你的用户名@公网IP
        ```
    
    **注意**：如果运行 ssh-copy-id 无此命令，可直接将本地 `~/.ssh`目录中的`id_rsa.pub`文件内容添加到服务器的`~/.ssh/authorized_keys` 文件中
    
    -   在服务器服务设置仅允许密钥登陆
        
        ```bash
        sudo rm -f /etc/ssh/sshd_config.d/*.conf
        sudo bash -c 'cat > /etc/ssh/sshd_config.d/custom.conf <<EOF
        PubkeyAuthentication yes
        PasswordAuthentication no
        PermitRootLogin no
        AllowUsers 你的用户名
        Port 你的端口
        ClientAliveInterval 60
        ClientAliveCountMax 3
        EOF'
        
        sudo sshd -t
        sudo systemctl restart ssh
        ```
    
-   配置 nginx
    
    ```nginx
    sudo apt install nginx
    
    sudo bash -c 'cat > /etc/nginx/conf.d/default.conf <<EOF
    server {
        listen 80;
        server_name your_domain;
        return 301 https://\$host\$request_uri;
    }
    
    server {
        listen 443 ssl;
        server_name your_domain;
    
        ssl_certificate /etc/nginx/ssl/your_domain/certificate.crt;
        ssl_certificate_key /etc/nginx/ssl/your_domain/private.key;
    
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers HIGH:!aNULL:!MD5;
        ssl_prefer_server_ciphers on;
    
        location / {
            proxy_pass http://127.0.0.1:33033;
            proxy_set_header Host \$host;
            proxy_set_header X-Real-IP \$remote_addr;
            proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto \$scheme;
        }
    }
    EOF'
    
    sudo nginx -t
    sudo systemctl restart nginx
    ```
    
- 防火墙

    ```bash
    sudo apt install ufw
    sudo ufw enable
    
    sudo ufw allow 80
    
    sudo ufw limit 22022
    
    sudo ufw delete allow 80
    
    sudo ufw reload
    sudo ufw status
    ```

## 系统优化（谨慎使用）

- **关闭不需要的服务**

```bash
sudo systemctl disable NetworkManager-wait-online.service
sudo systemctl disable smbd.service
sudo systemctl disable nmbd.service
sudo systemctl disable winbind.service
```

- **清理不需要的内核**

```bash
sudo apt autoremove --purge
sudo dpkg --list | grep linux-image
```

根据列表，删除旧版本的 linux-image

```bash
sudo apt remove linux-image-xxx
sudo apt autoremove
```

- **限制内存占用**

```bash
sudo sh -c "cat /usr/lib/systemd/user/coredump-reporter.service | sed 's/MemoryLimit=.*/MemoryMax=500M/' > /tmp/coredump-reporter.service && mv /tmp/coredump-reporter.service /usr/lib/systemd/user/coredump-reporter.service"
systemctl --user daemon-reload
```

- **限制日志存储**

```bash
sudo sh -c '
  if ! grep -q "^SystemMaxUse=" /etc/systemd/journald.conf && ! grep -q "^#SystemMaxUse=" /etc/systemd/journald.conf; then
    echo "SystemMaxUse=10M" >> /etc/systemd/journald.conf
  else
    sed -i "s/^#*SystemMaxUse=.*/SystemMaxUse=10M/" /etc/systemd/journald.conf
  fi
'
sudo systemctl restart systemd-journald
```

- **提高开机速度**

```bash
sudo cp /etc/default/grub /etc/default/grub.bak
sudo sed -i 's/GRUB_CMDLINE_LINUX_DEFAULT="[^"]*"/GRUB_CMDLINE_LINUX_DEFAULT="quiet loglevel=3"/g' /etc/default/grub
sudo sed -i '$aGRUB_TIMEOUT_STYLE=hidden' /etc/default/grub
sudo update-grub
sudo reboot
```

## 桌面软件

### 浏览器

#### firefox

```bash
sudo install -d -m 0755 /etc/apt/keyrings
wget -q https://packages.mozilla.org/apt/repo-signing-key.gpg -O- | sudo tee /etc/apt/keyrings/packages.mozilla.org.asc > /dev/null
echo "deb [signed-by=/etc/apt/keyrings/packages.mozilla.org.asc] https://packages.mozilla.org/apt mozilla main" | sudo tee -a /etc/apt/sources.list.d/mozilla.list > /dev/null

echo '
Package: *
Pin: origin packages.mozilla.org
Pin-Priority: 1000
' | sudo tee /etc/apt/preferences.d/mozilla

sudo apt-get update && sudo apt-get install firefox
sudo apt-get install firefox-l10n-zh-cn
```

如果遇到分辨率问题，地址栏输入`about:config`回车，修改 `browser.display.os-zoom-behavior` 值为 0

#### edge

```bash
sudo apt install curl
curl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > microsoft.gpg
sudo install -o root -g root -m 644 microsoft.gpg /etc/apt/trusted.gpg.d/
sudo sh -c 'echo "deb [arch=amd64] https://packages.microsoft.com/repos/edge stable main" > /etc/apt/sources.list.d/microsoft-edge.list'

sudo apt update
sudo apt install microsoft-edge-stable
```

### 输入法

#### rime

-   安装 rime
    
    ```bash
    sudo apt install ibus
    sudo apt install ibus-rime
    ```
    
    依次点击 \[设置\] - \[键盘\] - \[添加输入源\] - \[中文\] - \[中文(RIME)\] 添加，然后修改优先级顺序
    
-   配置文件
    
    ```bash
    mkdir -p ~/.config/ibus/rime
    cat <<EOF > ~/.config/ibus/rime/default.custom.yaml
    patch:
      schema_list:
        - schema: luna_pinyin_simp
      menu:
        page_size: 9
    EOF
    ```
    

### 阅读器

#### readest

```bash
sudo mkdir -p /opt/readest
LATEST_TAG=$(curl -s https://api.github.com/repos/readest/readest/releases/latest | grep '"tag_name":' | sed -E 's/.*"([^"]+)".*/\1/')
sudo wget -O /opt/readest/readest.AppImage https://github.com/readest/readest/releases/download/${LATEST_TAG}/Readest_${LATEST_TAG#v}_amd64.AppImage
sudo wget -O /opt/readest/readest.png https://avatars.githubusercontent.com/u/190965649?s=200&v=4
sudo chmod +x /opt/readest/readest.AppImage
cat << EOF | sudo tee ~/.local/share/applications/readest.desktop > /dev/null
[Desktop Entry]
Name=Readest
Exec=/opt/readest/readest.AppImage
Icon=/opt/readest/readest.png
Type=Application
Categories=Utility;
Terminal=false
EOF
sudo chmod +x ~/.local/share/applications/readest.desktop
update-desktop-database ~/.local/share/applications
```

### 编辑器

#### typora

```bash
sudo apt install software-properties-common
wget -qO - https://typoraio.cn/linux/public-key.asc | sudo tee /etc/apt/trusted.gpg.d/typora.asc
sudo add-apt-repository 'deb https://typora.io/linux ./'
sudo apt update
sudo apt install typora
```

Deepin 系统可能无法正确索引，若失败可以手动添加

```bash
sudo cat << EOF > /etc/apt/sources.list.d/typora.list
deb https://typora.io/linux ./
EOF
sudo apt update
sudo apt install typora
```

安装后移除源

```bash
sudo rm -fr /etc/apt/sources.list.d/typora.list
sudo apt update
```

### 下载器

#### qbittorrent

```bash
sudo apt install fuse
sudo mkdir -p /opt/qbittorrent
sudo wget -O /opt/qbittorrent/qbittorrent.AppImage https://www.fosshub.com/qBittorrent.html?dwl=qbittorrent-5.0.3_x86_64.AppImage#
sudo chmod +x /opt/qbittorrent/qbittorrent.AppImage
sudo wget -O /opt/qbittorrent/qbittorrent.png https://avatars.githubusercontent.com/u/2131270?s=200&v=4
cat << EOF | sudo tee ~/.local/share/applications/qbittorrent.desktop > /dev/null
[Desktop Entry]
Name=Pot
Exec=/opt/qbittorrent/qbittorrent.AppImage
Icon=/opt/qbittorrent/qbittorrent.png
Type=Application
Categories=Internet;
Terminal=false
EOF
sudo chmod +x ~/.local/share/applications/qbittorrent.desktop
update-desktop-database ~/.local/share/applications
```

### 播放器

#### vlc

```bash
sudo apt update
sudo apt install vlc
```

### 终端

#### termius

**注意**：无法导出配置

```bash
wget -O /tmp/Termius.deb https://autoupdate.termius.com/linux/Termius.deb
sudo apt install -y /tmp/Termius.deb
sudo chown root:root /opt/Termius/chrome-sandbox
sudo chmod 4755 /opt/Termius/chrome-sandbox
```

#### tabby（推荐）

```bash
wget -O /tmp/tabby.deb https://github.com/Eugeny/tabby/releases/download/v1.0.221/tabby-1.0.221-linux-x64.deb
sudo apt install -y /tmp/tabby.deb
```

实现SFTP目录跟随

```bash
echo 'export PS1="$PS1\[\e]1337;CurrentDir=\$(pwd)\a\]"' >> ~/.bash_profile && source ~/.bash_profile
```

### 效率工具

#### pot

linux 版快捷键直接在系统添加： \[设置\] - \[键盘\] - \[查看自定义快捷键\] - \[自定义快捷键\]

-   输入翻译：`curl "127.0.0.1:60828/input_translate"`
    
-   划词翻译：`curl "127.0.0.1:60828/selection_translate"`
    
-   截图翻译：`curl "127.0.0.1:60828/ocr_translate"`
    

**注意**：v3.0.6版本AppImage存在bug，建议暂时使用v3.0.5版本（截图翻译暂不可用）

```bash
sudo apt install curl fuse tesseract-ocr
sudo mkdir -p /opt/pot
sudo wget -O /opt/pot/pot.AppImage https://github.com/pot-app/pot-desktop/releases/download/3.0.5/pot_3.0.5_amd64.AppImage
sudo chmod +x /opt/pot/pot.AppImage
sudo wget -O /opt/pot/pot.png https://avatars.githubusercontent.com/u/133363243?s=200&v=4
cat << EOF | sudo tee ~/.local/share/applications/pot.desktop > /dev/null
[Desktop Entry]
Name=Pot
Exec=/opt/pot/pot.AppImage
Icon=/opt/pot/pot.png
Type=Application
Categories=Internet;
Terminal=false
EOF
sudo chmod +x ~/.local/share/applications/pot.desktop
update-desktop-database ~/.local/share/applications
```

如果使用截图翻译可以关闭窗口动画

```bash
gsettings set org.gnome.desktop.interface enable-animations false
```

#### nextchat

**注意**：暂时不能修改输入语言，默认是英语

```bash
sudo apt install curl fuse
sudo mkdir -p /opt/nextchat
sudo wget -O /opt/nextchat/next-chat.AppImage "$(curl -s https://api.github.com/repos/ChatGPTNextWeb/ChatGPT-Next-Web/releases/latest | grep tag_name | cut -d '"' -f 4 | xargs -I {} echo "https://github.com/ChatGPTNextWeb/ChatGPT-Next-Web/releases/download/{}/next-chat_{}_amd64.AppImage")"
sudo chmod +x /opt/nextchat/next-chat.AppImage
sudo wget -O /opt/nextchat/next-chat.png https://avatars.github.com/u/153288546?s=200&v=4
cat << EOF | sudo tee ~/.local/share/applications/next-chat.desktop > /dev/null
[Desktop Entry]
Name=NextChat
Exec=/opt/nextchat/next-chat.AppImage
Icon=/opt/nextchat/next-chat.png
Type=Application
Categories=Internet;
Terminal=false
EOF
sudo chmod +x ~/.local/share/applications/next-chat.desktop
update-desktop-database ~/.local/share/applications
```

#### onedrive

-   安装 onedrive
    
    ```bash
    sudo apt install onedrive
    onedrive
    ```
    
    访问链接并登陆授权后复制uri输入回车
    
-   测试运行
    
    ```bash
    onedrive --dry-run --synchronize
    ```
    
-   同步所有文件
    
    ```bash
    onedrive --synchronize
    ```
    
-   同步指定目录
    
    ```bash
    onedrive --synchronize --single-directory 'Pictures'
    ```
    
-   配置文件
    
    ```bash
    sudo cp /usr/share/doc/onedrive/config ~/.config/onedrive/
    sudo chown $USER:$USER ~/.config/onedrive/config
    gnome-text-editor ~/.config/onedrive/config
    sudo systemctl restart --user onedrive
    ```
    
-   自动同步
    
    ```bash
    sudo systemctl enable --user onedrive
    sudo systemctl start --user onedrive
    sudo systemctl status --user onedrive 
    ```
    

### 刻录工具

#### etcher（兼容 Linux）

```bash
sudo wget -O /tmp/etcher.deb https://github.com/balena-io/etcher/releases/download/v1.19.25/balena-etcher_1.19.25_amd64.deb
sudo apt install -y /tmp/etcher.deb
```

#### Woeusb（兼容 Windows）

```bash
sudo apt update
sudo apt install bash coreutils util-linux grep gawk findutils grub-pc-bin parted wget dosfstools ntfs-3g wimtools p7zip gettext
wget -O woeusb.bash https://github.com/WoeUSB/WoeUSB/releases/download/v5.2.4/woeusb-5.2.4.bash
chmod +x ./woeusb.bash
sudo ./woeusb.bash --device "/path/to/iso" /dev/XXX --target-filesystem FAT
```

#### Ventoy （兼容多系统）

```bash
wget https://github.com/ventoy/Ventoy/releases/download/v1.0.99/ventoy-1.0.99-linux.tar.gz
tar -xvzf ventoy-1.0.99-linux.tar.gz
cd ventoy-1.0.99
sudo sh Ventoy2Disk.sh -i /dev/XXX
```

> Ventoy2Disk.sh 命令 \[选项\] /dev/XXX
> 
> 命令含义:
> 
> \-i 安装ventoy到磁盘中 (如果对应磁盘已经安装了ventoy则会返回失败)
> 
> \-I 强制安装ventoy到磁盘中，(不管原来有没有安装过)
> 
> \-u 升级磁盘中的ventoy版本
> 
> \-l 显示磁盘中的ventoy相关信息
> 
> 选项含义: (可选)
> 
> \-r SIZE\_MB 在磁盘最后保留部分空间，单位 MB (只在安装时有效)
> 
> \-s 启用安全启动支持 (默认是关闭的)
> 
> \-g 使用GPT分区格式，默认是MBR格式 (只在安装时有效)
> 
> \-L 主分区（镜像分区）的卷标 (默认是 Ventoy)

#### 常用 torrent

-   [Ubuntu 24.04](magnet:?xt=urn:btih:4A3F5E08BCEF825718EDA30637230585E3330599&dn=ubuntu-24.04.1-desktop-amd64.iso&tr=http%3A%2F%2Fp4p.arenabg.com%3A1337%2Fannounce&tr=udp%3A%2F%2F47.ip-51-68-199.eu%3A6969%2Fannounce&tr=udp%3A%2F%2F9.rarbg.me%3A2780%2Fannounce&tr=udp%3A%2F%2F9.rarbg.to%3A2710%2Fannounce&tr=udp%3A%2F%2F9.rarbg.to%3A2730%2Fannounce&tr=udp%3A%2F%2F9.rarbg.to%3A2920%2Fannounce&tr=udp%3A%2F%2Fopen.stealth.si%3A80%2Fannounce&tr=udp%3A%2F%2Fopentracker.i2p.rocks%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.coppersurfer.tk%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.cyberia.is%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.dler.org%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.internetwarriors.net%3A1337%2Fannounce&tr=udp%3A%2F%2Ftracker.leechers-paradise.org%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.openbittorrent.com%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.opentrackr.org%3A1337&tr=udp%3A%2F%2Ftracker.pirateparty.gr%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.tiny-vps.com%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.torrent.eu.org%3A451%2Fannounce)

-   [Windows 11](magnet:?xt=urn:btih:AD9B5D0D91DA92DA12C58D9CE549744C037ECF87&dn=Windows+11+Pro+24H2+b26100.2605+No+TPM+Preactivated+Multilingual+December+2024&tr=http%3A%2F%2Fp4p.arenabg.com%3A1337%2Fannounce&tr=udp%3A%2F%2F47.ip-51-68-199.eu%3A6969%2Fannounce&tr=udp%3A%2F%2F9.rarbg.me%3A2780%2Fannounce&tr=udp%3A%2F%2F9.rarbg.to%3A2710%2Fannounce&tr=udp%3A%2F%2F9.rarbg.to%3A2730%2Fannounce&tr=udp%3A%2F%2F9.rarbg.to%3A2920%2Fannounce&tr=udp%3A%2F%2Fopen.stealth.si%3A80%2Fannounce&tr=udp%3A%2F%2Fopentracker.i2p.rocks%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.coppersurfer.tk%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.cyberia.is%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.dler.org%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.internetwarriors.net%3A1337%2Fannounce&tr=udp%3A%2F%2Ftracker.leechers-paradise.org%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.openbittorrent.com%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.opentrackr.org%3A1337&tr=udp%3A%2F%2Ftracker.pirateparty.gr%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.tiny-vps.com%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.torrent.eu.org%3A451%2Fannounce)

-   [Deepin 23](https://www.mediafire.com/file/nvz85eg88nde7w2/deepin-desktop-community-23-amd64.iso.torrent/file)

## 参考链接

-   [**如何在 Ubuntu 22.04 中安装和设置 OneDrive 客户端**](https://cn.linux-terminal.com/?p=7582)
    
-   [**thinkpad笔记本启动显示ACPI错误解决方法**](https://bbs.deepin.org/post/202565)
    
-   [**Ventoy使用说明**](https://www.ventoy.net/cn/doc_start.html)

