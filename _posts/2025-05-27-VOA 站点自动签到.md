---
layout: mypost
title: VOA 站点自动签到
date: 2025-05-27
published: false
categories: 逆向
tags: 
 - linux
---

# VOA 站点自动签到

## 安装 WPy

[点击这里](https://github.com/winpython/winpython/releases/download/15.2.20250412/Winpython64-3.12.10.0dotb3.exe) 下载 WPy并解压到 `%USERPROFILE%` 重命名解压后目录为 `WPy`

## 开机自启

快捷键 Win+R 输入 `shell:startup` 进入启动项目录，右键新建快捷方式，输入
```
"%USERPROFILE%\WPy\python\python.exe" "%USERPROFILE%\WPy\notebooks\test\main.py"
```

点击下一步输入名称，如 `Test` 完成创建

```python
from DrissionPage import Chromium, ChromiumOptions
import time
import os

class VoAPIAutomation:
    def __init__(self):
        self.co = ChromiumOptions()
        self.co.auto_port()
        self.co.set_timeouts(base=1)
        
        # 设置Chrome路径
        chrome_path = os.path.join(os.environ['USERPROFILE'], 'Downloads', 'chrome-win', 'chrome.exe')
        self.co.set_browser_path(chrome_path)
        
        # 设置扩展路径
        EXTENSION_PATH = os.path.abspath(os.path.join(os.path.dirname(__file__), "turnstilePatch"))
        self.co.add_extension(EXTENSION_PATH)
        
        # 初始化浏览器
        self.browser = Chromium(self.co)
        self.page = self.browser.get_tabs()[-1]
        
    def get_turnstile_token(self):
        """获取Turnstile验证码令牌"""
        self.page.run_js("try { turnstile.reset() } catch(e) { }")
        turnstileResponse = None

        for i in range(0, 15):
            try:
                turnstileResponse = self.page.run_js("try { return turnstile.getResponse() } catch(e) { return null }")
                if turnstileResponse:
                    return turnstileResponse
                
                challengeSolution = self.page.ele("@name=cf-turnstile-response")
                challengeWrapper = challengeSolution.parent()
                challengeIframe = challengeWrapper.shadow_root.ele("tag:iframe")
                challengeIframeBody = challengeIframe.ele("tag:body").shadow_root
                challengeButton = challengeIframeBody.ele("tag:input")
                challengeButton.click()
            except:
                pass
            time.sleep(1)
        self.page.refresh()
        raise Exception("failed to solve turnstile")

    def close_notice_dialog(self):
        """关闭公告弹窗"""
        try:
            # 等待弹窗出现
            time.sleep(2)
            # 使用精确的XPath定位关闭公告按钮
            close_button = self.page.ele('xpath://button[.//span[contains(text(), "今日关闭")]]')
            if close_button:
                close_button.click()
                print("成功关闭公告弹窗")
                time.sleep(1)  # 等待弹窗完全关闭
            else:
                print("未找到关闭公告按钮")
        except Exception as e:
            print(f"关闭弹窗时出现错误: {str(e)}")

    def login(self, account_config):
        """登录操作"""
        site_url = account_config['site_url']
        username = account_config['username']
        password = account_config['password']
        has_notice = account_config.get('has_notice', False)
        has_turnstile = account_config.get('has_turnstile', False)
        
        # 访问登录页面
        login_url = f"{site_url}/login"
        self.page.get(login_url)
        time.sleep(2)

        # 关闭公告弹窗（如果配置了有公告）
        if has_notice:
            self.close_notice_dialog()
        
        # 输入用户名和密码
        username_input = self.page.ele('@id=username')
        username_input.input(username)

        password_input = self.page.ele('@id=password')
        password_input.input(password)
        
        # 获取turnstile令牌（如果配置了有turnstile）
        if has_turnstile:
            token = self.get_turnstile_token()
            print(f"获取到turnstile令牌: {token}")
        else:
            print("该网站无turnstile验证，跳过")
            token = None
        
        # 使用精确的选择器定位登录按钮
        login_button = self.page.ele('css:.semi-button-primary[type="submit"]')
        if login_button:
            login_button.click()
            print("点击登录按钮")
        else:
            print("未找到登录按钮")
        
        print("登录完成")
        
        return token

    def check_in(self, account_config):
        """签到操作"""
        site_url = account_config['site_url']
        has_turnstile = account_config.get('has_turnstile', False)
        
        # 访问个人资料页面
        profile_url = f"{site_url}/profile"
        self.page.get(profile_url)
        time.sleep(2)
        
        # 获取turnstile令牌（如果配置了有turnstile）
        if has_turnstile:
            token = self.get_turnstile_token()
            print(f"获取到签到页面的turnstile令牌: {token}")
        else:
            print("该网站无turnstile验证，跳过")
            token = None
        
        # 点击签到按钮
        check_in_button = self.page.ele('xpath://span[contains(text(), "今日签到打卡")]/..')
        check_in_button.click()
        
        print("签到完成")
        return token

    def run(self, accounts_config):
        """运行完整的自动化流程"""
        try:
            for account in accounts_config:
                site_url = account['site_url']
                username = account['username']
                
                print(f"\n开始处理网站: {site_url}")
                print(f"用户名: {username}")
                
                # 登录
                self.login(account)
                time.sleep(3)
                
                # 签到
                self.check_in(account)
                time.sleep(3)
                
        finally:
            # 确保浏览器被关闭
            self.browser.quit()

def main():
    # 多网站多用户配置数组
    accounts_config = [
        {
            'site_url': 'https://demo.voapi.top',
            'username': 'linuxdo_3282',
            'password': 'Q2kT%9fL7mB',
            'has_notice': True,
            'has_turnstile': True            
        },
        {
            'site_url': 'https://linjinpeng-voapi.hf.space',
            'username': 'linuxdo_104',
            'password': 'Q2kT%9fL7mB',
            'has_notice': False,
            'has_turnstile': False            
        }
        # 可以继续添加更多网站和用户
    ]
    
    automation = VoAPIAutomation()
    automation.run(accounts_config)

if __name__ == "__main__":
    main()
```



